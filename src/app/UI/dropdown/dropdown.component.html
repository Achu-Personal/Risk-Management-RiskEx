<div tabindex="0" class="dropdown-container" [ngStyle]="{'width': width+'%'}">
  <!-- Dropdown Box -->
  <div class="dropdown-header" (click)="toggleDropdown($event)" [class.open]="isDropdownOpen">
    <span [class.placeholder-text]="!hasValue()">{{ getSelectedText() }}</span>

    <div class="dropdown-icons">
      <!-- Clear Icon (X) - Only show if allowClear is true and there's a value -->
      <span
        *ngIf="allowClear && hasValue()"
        class="clear-icon"
        (click)="clearSelection($event)"
        title="Clear selection">
        ✕
      </span>

      <!-- Dropdown Arrow -->
      <span class="arrow">&#9662;</span>
    </div>
  </div>

  <!-- Dropdown List -->
  <div class="dropdown-list" *ngIf="isDropdownOpen && isGlobalDropdownOpen">
    <!-- Search Bar -->
    <input
      type="text"
      [(ngModel)]="searchQuery"
      placeholder="Search..."
      class="search-box"
      (click)="$event.stopPropagation()" />

    <!-- Scrollable Options -->
    <div class="dropdown-items">
      <!-- Clear Option at the top (only if allowClear is true and there's a value) -->
      <div
        *ngIf="allowClear && hasValue()"
        class="dropdown-item clear-option"
        (click)="clearSelection($event)">
        {{ clearText }}
        <span class="clear-icon-inline">✕</span>
      </div>

      <!-- Divider after clear option -->
      <div *ngIf="allowClear && hasValue()" class="dropdown-divider"></div>

      <!-- Regular Options -->
      <div
        *ngFor="let item of filteredOptions"
        (click)="selectOption(item)"
        class="dropdown-item"
        [class.selected]="value === item[valueField]"
        (click)="$event.stopPropagation()">
        {{ item[displayField] }}
        <span *ngIf="item[codeField]"> ({{ item[codeField] }})</span>

        <!-- Checkmark for selected item -->
        <span *ngIf="value === item[valueField]" class="check-icon">✓</span>
      </div>
    </div>
  </div>
</div>
